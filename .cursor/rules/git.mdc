---
description: Git workflow and commit conventions
globs: ["**/*"]
alwaysApply: false
---

# Git Conventions

## Commit Message Format

Use conventional commits with scope:

```
<type>(<scope>): <description>

<optional body>

<optional footer>
```

### Types

- `feat` - New feature
- `fix` - Bug fix
- `test` - Adding or updating tests
- `refactor` - Code change that neither fixes a bug nor adds a feature
- `docs` - Documentation only changes
- `style` - Formatting, missing semi-colons, etc.
- `chore` - Maintenance tasks
- `ci` - CI/CD changes

### Scopes

- `tree` - Tree module
- `snps` - SNP database module
- `vcf` - VCF parsing module
- `classifier` - Classification logic
- `cli` - Command-line interface
- `tests` - Test infrastructure

### Examples

```
feat(tree): Add YFull tree parser with node lookup

- Implement Tree and Node dataclasses
- Add from_json() class method
- Support depth-first traversal
- 100% test coverage

Closes #12
```

```
fix(vcf): Handle missing GQ field in VCF records

Some VCF files don't include genotype quality. Now defaults to None
instead of raising KeyError.
```

```
test(classifier): Add edge case tests for empty VCF

- Test behavior when VCF has no Y chromosome variants
- Test behavior when all variants are filtered
```

## Commit Guidelines

### Atomic Commits

Each commit should represent one logical change:

- ✅ One feature per commit
- ✅ One bug fix per commit
- ❌ Multiple unrelated changes in one commit

### Test with Code

Include tests in the same commit as the feature:

```
feat(snps): Add position lookup by reference genome

- Implement get_by_position() method
- Support grch37, grch38, and t2t coordinates
- Add comprehensive unit tests
```

### Before Committing

Always run checks before committing:

```bash
# Format
black src/ tests/

# Lint
ruff check src/ tests/ --fix

# Type check
mypy src/

# Test
pytest tests/ -v
```

## Branch Naming

```
feature/<short-description>
fix/<issue-number>-<short-description>
test/<what-testing>
refactor/<what-refactoring>
```

Examples:
- `feature/ancient-dna-filtering`
- `fix/42-vcf-missing-samples`
- `test/integration-tests`
- `refactor/classifier-scoring`

## Pull Request Guidelines

### PR Title

Follow the same format as commit messages:

```
feat(classifier): Add likelihood-based scoring
```

### PR Description

Include:
1. What the PR does
2. Why it's needed
3. How to test it
4. Any breaking changes

### Checklist

Before requesting review:

- [ ] All tests pass (`pytest tests/ -v`)
- [ ] Code is formatted (`black src/ tests/`)
- [ ] No linting errors (`ruff check src/ tests/`)
- [ ] Types check (`mypy src/`)
- [ ] New code has tests
- [ ] Documentation updated if needed
